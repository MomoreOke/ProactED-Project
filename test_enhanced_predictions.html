<!DOCTYPE html>
<html>
<head>
    <title>Test Enhanced ML Predictions</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Test Enhanced ML Predictions</h1>
    
    <div>
        <h3>Test Single Equipment Prediction</h3>
        <input type="number" id="equipmentId" placeholder="Equipment ID" value="1">
        <button onclick="testSinglePrediction()">Test Single Prediction</button>
        <div id="singleResult"></div>
    </div>
    
    <div>
        <h3>Test Enhanced Prediction with Maintenance Scheduling</h3>
        <button onclick="testEnhancedPrediction()">Test Enhanced Prediction</button>
        <div id="enhancedResult"></div>
    </div>
    
    <div>
        <h3>Test ML API Health</h3>
        <button onclick="testApiHealth()">Test API Health</button>
        <div id="healthResult"></div>
    </div>

    <script>
        // Test single equipment prediction via ML API directly
        async function testSinglePrediction() {
            const equipmentId = document.getElementById('equipmentId').value;
            
            try {
                const response = await fetch('http://localhost:5000/api/equipment/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        equipment_id: equipmentId,
                        age_months: 24,
                        operating_temperature: 55.5,
                        vibration_level: 2.3,
                        power_consumption: 180.0
                    })
                });
                
                const result = await response.json();
                document.getElementById('singleResult').innerHTML = 
                    '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('singleResult').innerHTML = 
                    '<div style="color: red;">Error: ' + error.message + '</div>';
            }
        }
        
        // Test enhanced prediction with maintenance scheduling
        async function testEnhancedPrediction() {
            const equipmentId = document.getElementById('equipmentId').value;
            
            try {
                const response = await fetch(`http://localhost:7032/ModelInterpretability/EnhancedPrediction?equipmentId=${equipmentId}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const html = await response.text();
                    document.getElementById('enhancedResult').innerHTML = 
                        '<iframe style="width:100%; height:400px; border:1px solid #ccc;" srcdoc="' + 
                        html.replace(/"/g, '&quot;') + '"></iframe>';
                } else {
                    document.getElementById('enhancedResult').innerHTML = 
                        '<div style="color: red;">HTTP Error: ' + response.status + ' ' + response.statusText + '</div>';
                }
            } catch (error) {
                document.getElementById('enhancedResult').innerHTML = 
                    '<div style="color: red;">Error: ' + error.message + '</div>';
            }
        }
        
        // Test ML API health
        async function testApiHealth() {
            try {
                const response = await fetch('http://localhost:5000/api/health');
                const result = await response.json();
                document.getElementById('healthResult').innerHTML = 
                    '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('healthResult').innerHTML = 
                    '<div style="color: red;">Error: ' + error.message + '</div>';
            }
        }
        
        // Test API health on page load
        window.onload = function() {
            testApiHealth();
        };
    </script>
</body>
</html>
